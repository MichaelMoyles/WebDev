<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel = stylesheet type ="text/css" href="./senators.css">
        <title>United States Senate</title>
    </head>
    
    <body>
        <nav>
            <p>United States Senate</p>
        </nav>
        
        <div class="banner"></div>

        <div class="reps">
            <div id="id01"></div>
        </div>
        
        <div class="leaders">
        
            <div class="dem">
                <h3>Democrats</h3>
                <div id="id02"></div>
            </div>
            
            <div class="rep">
                <h3>Republicans</h3>
                <div id="id03"></div>
            </div>
           
        </div>
      
        <div id="filters">
            <button class="party" type='button' onclick='partyFilter()'>Democrat</button>
            <button class="party" type='button' onclick='partyFilter()'>Republican</button>
            
        </div>
        
        <div id="senatorInfo"> 
            <div id="popup"></div> 
            <div id="id04"></div>
            <div id="detailedInfo"></div>
            
        </div>
        
        <script>
            // Initalising a global variable to hold the JSON data
            var parsedObj;
            var xmlhttp = new XMLHttpRequest();
            var url = "senators.json";
            
            // Parses the JSON data and invokes the function run()
            xmlhttp.onreadystatechange = function() {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    parsedObj = JSON.parse(xmlhttp.responseText);
                    run()
                }
            };
            
            xmlhttp.open("GET", url, true);
            xmlhttp.send();
            
            // Seperate out functions that utilise the JSON data for better readability
            function run(){
                reps(parsedObj);
                senatorInfo(parsedObj);
            };
            
            /* Function that counts the instances of democrat, republican and independents and populates the list of democrats and republicans in leadership positions. All completed in one loop to reduce looping time */
            function reps(obj) {
                var senators = obj.objects;
                var repsTable = "<table class='repsTable'>";
                var dem = 0;
                var repub = 0;
                var ind = 0;
                var demInfo = "<ul>";
                var repInfo = "<ul>";
                for (var i=0; i <senators.length; i++) {   
                    if (senators[i].party == "Democrat") {
                        dem += 1;
                            if (senators[i].leadership_title != null) {
                                var senatorTitle = senators[i].leadership_title
                                var senatorLastName = senators[i].person.lastname;
                                var senatorFirstName = senators[i].person.firstname;
                                var senatorParty = senators[i].party;
                                demInfo += "<li>" + senatorTitle + ": " + senatorFirstName + " " + senatorLastName + " (" + senatorParty + ")" + "</li>";
                            }
                    } else if (senators[i].party == "Republican") {
                        repub += 1;
                            if (senators[i].leadership_title != null) {
                                var senatorTitle = senators[i].leadership_title
                                var senatorLastName = senators[i].person.lastname;
                                var senatorFirstName = senators[i].person.firstname;
                                var senatorParty = senators[i].party;
                                repInfo += "<li>" + senatorTitle + ": " + senatorFirstName + " " + senatorLastName + " (" + senatorParty + ")" + "</li>";
                            }
                    } else {
                        ind += 1 //There are no independents in leadership positions
                    }
                }
                
                repsTable += "<tr><th colspan=3>Number of Representatives</th></tr>";
                repsTable += "<tr><td>Democrats</td><td>Republicans</td><td>Independents</td></tr>";
                repsTable += "<tr><td>" + dem + "</td><td>" + repub + "</td><td>" + ind + "</td></tr></table>";
                
                demInfo += "</ul>";
                repInfo += "</ul>";
                
                document.getElementById("id01").innerHTML = repsTable;
                document.getElementById("id02").innerHTML = demInfo;
                document.getElementById("id03").innerHTML = repInfo;
            }
            
            /* Function that creates the 3 senator info tables through one for loop to minimise looping time. All senators are Democrat, Republican or Other (Independent) */
            function senatorInfo(obj) {
                document.getElementById("detailedInfo").innerHTML = null;
                var senators = obj.objects;
                var senatorTable = "";
                
                /* In order to track which button was clicked I dynamically add an class name to each table data element, could expand on this with if statements and add a class name for the party, for the particular state and rank for the filtering dropdown */
                for (var i=0; i <senators.length; i++) {
                        var senatorLastName = senators[i].person.lastname;
                        var senatorFirstName = senators[i].person.firstname;
                        var senatorParty = senators[i].party;
                        var senatorState = senators[i].state;
                        var senatorGender = senators[i].person.gender_label;
                        var senatorRank = senators[i].senator_rank_label;
                        senatorTable += "<div class='border "+ i + " " + senatorParty + " " + senatorRank + "'><p>" + senatorFirstName + " " + senatorLastName + "</p><p>" + senatorParty + "</p><p>" + senatorState + "</p><p>" + senatorGender +"</p><p>" + senatorRank + "</p><p><button type='button' onclick='senDetailsBtnClicked("+ i +")'>Details</button></p></div>";        
                }
                document.getElementById("id04").innerHTML = senatorTable;
            }
            
            /* Below is a proof of concept, when the details button is clicked the below runs, taking away the 3 tables and leaving the details tables. Can fix the jumping around later on by making the details table appear in the middle and adding an event to the close that auto brings you back to the class name of the previously clicked details button  */
            
            function senDetailsBtnClicked(i) {
                
                var senators = parsedObj.objects;
                var senDetailedInfo = ""
                var senatorLastName = senators[i].person.lastname;
                var senatorFirstName = senators[i].person.firstname;
                var senatorParty = senators[i].party;
                var senatorState = senators[i].state;
                var senatorGender = senators[i].person.gender_label;
                var senatorRank = senators[i].senator_rank_label;
                var senatorOffice = senators[i].extra.office;
                var senatorDOB = senators[i].person.birthday;
                var senatorStartDate = senators[i].startdate;
                var senatorYoutube = senators[i].person.youtubeid;
                var senatorTwitter = senators[i].person.twitterid;
                var senatorWebsite = senators[i].website;
                
                senDetailedInfo += "<div class='popup "+ i + " " + senatorParty + senatorRank + "'><p>" +"Name :" + senatorFirstName + " " + senatorLastName + "</p><p>" +"Party: " +senatorParty + "</p><p>" + "State: " + senatorState + "</p><p>" + "Gender: " + senatorGender +"</p><p>" + "Rank: " +senatorRank + "</p><p>" + "Office : " + senatorOffice + "</p><p>" + "DOB: " + senatorDOB + "</p><p>" +"Start Date: " +senatorStartDate +"</p><p>" + "YoutubeID: " + senatorYoutube + "</p><p>" + "TwitterID: " + senatorTwitter + "</p><p>" +"Website: <a href='" + senatorWebsite + "'target = '_blank'>" + senatorWebsite +"</a>" +"</p><p> <button type='button' onclick='senatorInfo(parsedObj)'>Close</button></p></div>";
                
                document.getElementById("detailedInfo").innerHTML = senDetailedInfo;
            }
            
            
            function partyFilter() {
                // Remove check for each party in the above for loop, then parse the data differently in the filtering, pass the filters through this function into the above function. Need to pass the object into the function rather than use it in the function itself for this to work
                var filters = parsedObj.objects;
                var party = document.getElementsByClassName("party")[0].innerText;
                var party = document.getElementsByClassName("party")[1].innerText;
                console.log(party);
                
                for (var i=0; i <filters.length; i++) {
                    if (party != filters[i].party) {
                        console.log(filters[i].party)
                        filters.splice(i, 1)
                    }
                }
                console.log(filters)
                /*
                var partyFilter = ""
                var senatorLastName = senators[i].person.lastname;
                var senatorFirstName = senators[i].person.firstname;
                var senatorParty = senators[i].party;
                var senatorState = senators[i].state;
                var senatorGender = senators[i].person.gender_label;
                var senatorRank = senators[i].senator_rank_label;
                
                senDetailedInfo += "<div class='border democrat "+ i + senatorParty + "'><p>" + senatorFirstName + " " + senatorLastName + "</p><p>" + senatorParty + "</p><p>" + senatorState + "</p><p>" + senatorGender +"</p><p>" + senatorRank + "</p><p><button type='button' onclick='senatorInfo()'>Close</button></p></div>";
                
                document.getElementById("id04").innerHTML = null;
                document.getElementById("detailedInfo").innerHTML = senDetailedInfo;*/
            }
            
        </script>
    </body>
</html>
